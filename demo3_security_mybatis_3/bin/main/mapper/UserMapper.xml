<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.demo.mapper.UserMapper">
	<!--
	    mybatis.type-aliases-package=com.example.demo.dto
	    원칙 : type="com.example.demo.dto.Users"
	  -->
  <resultMap type="Users" id="userMap">
        <id     property="userNo"  column="user_no" />
        <result property="userId"  column="user_id" />
        <result property="userPw"  column="user_pw" />
        <result property="name"    column="name" />
        <result property="email"   column="email" />
        <result property="enabled" column="enabled" />
        <result property="regDate" column="reg_date" />
        <result property="updDate" column="upd_date" />

        <collection property="authList" resultMap="authMap"></collection>
    </resultMap>
    <!--  
    	List<UserAuth> authList  구현 >> collection<authMap> 
    -->
    <resultMap type="UserAuth" id="authMap">
        <result property="userId" column="user_id" />
        <result property="auth" column="auth" />
    </resultMap>
    <!--  
    Users login(String username);
	int join(Users user) throws Exception;
	int insertAuth(UserAuth userAuth) throws Exception;
    -->
    
    <select id="login" resultMap="userMap" > 
    	select 	   u.user_no, 
			       u.user_id,
			       u.user_pw,
			       u.name,
			       u.email,
			       u.enabled,
			       u.reg_date,
			       u.upd_date,
			       auth.auth
		from user u join user_auth auth 
		     on u.user_id = auth.user_id
		where u.user_id=#{userId}    
    </select>
    
    <!-- 
    	security 사용하면 회원가입시
    	권한(role) 같이부여
    	1. default  > role > ROLE_USER
    	2. @Transaction 처리 쿼리 2번
    	3. PL-SQL  Trigger 사용해서 
     -->
  	<insert id="join" >
        insert into user(user_id , user_pw , name , email)
        values( #{userId} , #{userPw} ,#{name} , #{email})
    </insert>
	
	<!-- 
		권한등록
	 -->
	 <insert id="insertAuth" parameterType="UserAuth">
	 	insert into user_auth(user_id, auth)
	 	values(#{userId} , #{auth})
	 </insert>

</mapper>
